{"pageProps":{"frontmatter":{"layout":"ballerina-asyncapi-support-left-nav-pages-swanlake","title":"AsyncAPI tool","description":"Check out how the Ballerina AsyncAPI tool makes it easy for you to start developing a service documented in an AsyncAPI contract.","keywords":"ballerina, programming language, asyncapi, contract","permalink":"/learn/asyncapi-tool/","active":"asyncapi-tool","intro":"AsyncAPI is a specification, which is used to describe and document message-driven APIs in a machine-readable format for easy development, discovery, and integration. Ballerina Swan Lake supports the AsyncAPI Specification version 2.x.","redirect_from":["/learn/ballerina-asyncapi-support","/learn/ballerina-asyncapi-support/","/learn/asyncapi-tool"]},"content":"\nThe Ballerina AsyncAPI tool will make it easy for you to start the development of an event API documented in an AsyncAPI contract in Ballerina by generating a Ballerina service and listener skeletons.\n\n> **Prerequisite:** Install the latest [Ballerina Swan Lake distribution](https://ballerina.io/downloads/).\n\n## Generate Ballerina sources from AsyncAPI contracts\n\nIf you prefer the design-first approach, use an AsyncAPI definition to generate Ballerina sources using the AsyncAPI CLI command below.\n\n```bash\nbal asyncapi -i <asyncapi-contract>\n```\n\nThe generated sources can be used as code templates to start the service implementation. For example,\n\n```bash\nbal asyncapi -i hello.yaml\n```\n\nThis generates a Ballerina source (i.e., the four Ballerina files below) from the given AsyncAPI definition file.\n\n1. `data_types.bal` - contains all the Ballerina data types extracted from the AsyncAPI definition\n2. `service_types.bal` - contains all the service types relevant to the event API described in the AsyncAPI definition\n3. `listener.bal` - contains the HTTP listener, which listens to the relevant third-party service\n4. `dispacther_service.bal` - contains the event dispatching logic\n\nThe generated Ballerina sources will be written into the same directory from which the command is run. The above command can be run from anywhere on the execution path. It is not mandatory to run it from within a Ballerina package. If you want to generate Ballerina sources to a specific provided output location, you can modify the above command as below.\n\n```bash\nbal asyncapi -i hello.yaml -o ./output_path\n```\n\n## Example of the usage of the tool\n\nBelow is an example of the usage of the AsyncAPI tool based on the [AsyncAPI specification for Slack](https://github.com/ballerina-platform/asyncapi-triggers/blob/main/asyncapi/slack/asyncapi.yml).\n\n```yaml\nasyncapi: 2.1.0\nx-ballerina-event-identifier:\n  type: \"body\"\n  path: \"event.type\"\ncomponents:\n  schemas:\n    GenericEventWrapper:\n      additionalProperties: true\n      description: Adapted from auto-generated content\n      properties:\n        event:\n          additionalProperties: true\n          properties:\n            event_ts:\n              title: When the event was dispatched\n              type: string\n            type:\n              title: The specific name of the event\n              type: string\n            text:\n              title: The message content\n              type: string\n          required:\n            - type\n            - event_ts\n          title: \"The actual event, an object, that happened\"\n          type: object\n      required:\n        - event\n      title: Standard event wrapper for the Events API\n      type: object\nchannels:\n  app:\n    subscribe:\n      message:\n        oneOf:\n          - x-ballerina-event-type: \"app_mention\"\n            externalDocs:\n              description: Event documentation for app_mention\n            payload:\n              $ref: \"#/components/schemas/GenericEventWrapper\"\n            summary: Subscribe to only the message events that mention your app or bot\n            tags:\n              - name: allows_user_tokens\n              - name: app_event\n            x-scopes-required: []\n            x-tokens-allowed:\n              - user\n```\n\nThere are custom tags in this YAML starting with `x-ballerina`. Those tags are being used for the purposes below.\n\n- `x-ballerina-event-identifier` - when the listener receives an event from the event source (Slack is the event source in this scenario), there should be a way to identify the event type. This includes two parts, `type` and `path`. Type can be either `header` or `body`. In other words, the type of the event can be included in the payload either as a header or as an attribute in the body.\n\n  > **Note:** Currently, this tool supports only HTTP-based event APIs. The path is equal to the header name if the type is `header`, or to the JSON path of the attribute if the type is `body`.\n\n- `x-ballerina-event-type` - this should be there in every event inside the channel. This is the name of the event or the value of the above-mentioned attribute for a specific event.\n\n### Generate Ballerina sources\n\nExecute the command below on the above file. This will generate four files as mentioned above.\n\n```bash\nbal asyncapi -i slack.yaml\n```\n\n### Modify the generated sources\n\nThe generated files can be modified according to the custom requirements. When modifying the generated code segments, it will be easier to consider the facts below.\n\n- All the incoming requests will be coming to the resource function in the `dispatcher_service.bal` file. Hence, if there is a necessity to add an authentication logic for the incoming calls, that logic can be included there before processing the incoming HTTP request.\n- If more information is needed when initializing the listener like secrets, endpoint URLs, tokens, refresh tokens, etc., update the `init` function in the `listener.bal` file.\n\n### Execute the generated sources\n\nFollow the steps below to use the generated Ballerina sources.\n\n1\\. Create an empty folder and copy all the generated files to it.\n\n2\\. Execute the command below from the root of the folder. This generates a `Ballerina.toml` file in the root of the folder.\n\n```bash\nbal init\n```\n\n3\\. Create a new Ballerina file inside the folder (e.g., `slack_service.bal`) and paste the code below to it.\n\n```ballerina\nlistener Listener webhookListener = new(8090);\n\nservice AppService on webhookListener {\n  remote function onAppMention(GenericEventWrapper event) returns error? {\n      //Implement the logic to use the received `event` here.\n  }\n}\n```\n\n4\\. Execute the command below from the root of the folder to execute this service.\n\n```bash\nbal run\n```\n\nBelow are some example libraries generated using the tool.\n\n| Module     | AsyncAPI specification                                                                                                                | Generated and modified code                                                                                              | Published module                                                                               |\n| ---------- | ------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------- |\n| **Slack**  | <a href=\"https://github.com/ballerina-platform/asyncapi-triggers/blob/main/asyncapi/slack/asyncapi.yml\">`asyncapi.yml` of Slack</a>   | <a href=\"https://github.com/ballerina-platform/asyncapi-triggers/tree/main/asyncapi/slack\">asyncapi-triggers/slack</a>   | <a href=\"https://central.ballerina.io/ballerinax/trigger.slack\">ballerinax/trigger.slack</a>   |\n| **GitHub** | <a href=\"https://github.com/ballerina-platform/asyncapi-triggers/blob/main/asyncapi/github/asyncapi.yml\">`asyncapi.yml` of GitHub</a> | <a href=\"https://github.com/ballerina-platform/asyncapi-triggers/tree/main/asyncapi/github\">asyncapi-triggers/github</a> | <a href=\"https://central.ballerina.io/ballerinax/trigger.github\">ballerinax/trigger.github</a> |\n","id":"asyncapi-tool","sub":"ballerina-tooling","third":"","slug":"ballerina-tooling/asyncapi-tool"},"__N_SSG":true}