---
layout: ballerina-example-page
title: Local Transactions with participants
description: Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below.
permalink: /1.0/learn/by-example/local-transactions-with-participants
redirect_from:
  - /v1-0/learn/by-example/local-transactions-with-participants
  - /v1-0/learn/by-example/local-transactions-with-participants.html
---
<div class="row cBallerina-io-Gray-row">
        <div class="container cBallerinaBySampleContainer">
            <div class="FullCode">
                <div class="highlight"><pre><span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">io</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">transactions</span><span class="p">;</span><span class="nx">public</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">transaction</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">res</span> <span class="p">=</span> <span class="nx">trap</span> <span class="nx">localTransactionParticipant</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">res</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Local participant panicked.&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="nx">onretry</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Retrying transaction&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="nx">committed</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Transaction committed&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="nx">aborted</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Transaction aborted&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nd">@transactions:Participant {</span>
    <span class="nx">oncommit</span><span class="p">:</span> <span class="nx">participantOnCommit</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">localTransactionParticipant</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Invoke local participant function.&quot;</span><span class="p">);</span>
    <span class="nx">error</span> <span class="nx">er</span> <span class="p">=</span> <span class="nx">error</span><span class="p">(</span><span class="s">&quot;Simulated Failure&quot;</span><span class="p">);</span>
    <span class="nx">panic</span> <span class="nx">er</span><span class="p">;</span>
<span class="p">}</span><span class="kd">function</span> <span class="nx">participantOnCommit</span><span class="p">(</span><span class="kt">string</span> <span class="nx">transactionId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Local participant committed function handler...&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

            </div>

            <div class="col-xs-12 col-sm-12 col-md-12">
                <table class="cTopInfoContainer cTopControlsContainer">
                    <tr>
                        <td class="cLeftTD">
                            <h2>Local Transactions with participants</h2>
                            <p><p>A Ballerina transaction is a series of data manipulation statements
 that must either fully complete or fully fail, thereby, leaving the
 system in a consistent state. This example demonstrates the usage of
 transactions with local participants. If the participant panics even when it
 is trapped and if the initiator completes, the transaction is considered as a failure.
 Ballerina transactions are at the experimental stage.
 Hence, use the &ndash;experimental flag to enable them.</p>
</p>

                        </td>
                        <td class="cRightTD">
                            <div class="cTopButtonContainer">
                                
                                <div class="cButtonInfoContainer">
                                    <a class="prev" href="local-transactions.html">
                                        <span>< PREVIOUS</span>
                                        <p>Local Transactions</p>
                                    </a>
                                </div>
                                 
                                <div class="cButtonInfoContainer">
                                    <a class="next" href="xa-transactions.html">
                                        <span>NEXT ></span>
                                        <p>XA Transactions</p>
                                    </a>
                                </div>
                                
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="example" id="local-transactions-with-participants">
                <div class="col-xs-12 col-sm-12 col-md-12 cBBETable-container cCodeLeft">
                    <table class="cTopControlsContainer">
                        <tr>
                            <td class="cLeftTD">
                                <div class="cBBE-links">
                                    <ul>
                                        <!--<li>
                                            <a class="copy"><img src="/img/copy-icon.svg" /></a>
                                        </li>-->
                                        <li>
                                            <a target="_blank" href="https://github.com/ballerina-platform/ballerina-lang/tree/ballerina-1.0.x/examples/local-transactions-with-participants/"><img src="/img/github-logo-green.svg" /></a>
                                        </li>
                                    </ul>
                                </div>
                            </td>
                            <td></td>
                        </tr>
                    </table>

                    <table class="cTopBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>

                    
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>import ballerina/io;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>import ballerina/transactions;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Imports the <code>ballerina/transactions</code> module to use the participant annotation.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>public function main() {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    transaction {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The <code>transaction</code> block initiates the transaction. Thus, it is called the initiator.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        var res = trap localTransactionParticipant();
        if (res is error) {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Invokes the local participant.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>            io:println(&quot;Local participant panicked.&quot;);
        }
    } onretry {
        io:println(&quot;Retrying transaction&quot;);
    } committed {
        io:println(&quot;Transaction committed&quot;);
    } aborted {
        io:println(&quot;Transaction aborted&quot;);
    }
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The local participant gets panicked.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>@transactions:Participant {
    oncommit: participantOnCommit
}
function localTransactionParticipant() {
    io:println(&quot;Invoke local participant function.&quot;);
    error er = error(&quot;Simulated Failure&quot;);
    panic er;
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The <code>@transactions:Participant</code> annotation from the
 <code>transactions</code> package is used to indicate the function as a local participant.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code">
                                    <div class="highlight"><pre><code class=language-ballerina>function participantOnCommit(string transactionId) {
    io:println(&quot;Local participant committed function handler...&quot;);
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To run this sample, navigate to the directory that contains the
# `.bal` file, and execute the `ballerina run` command with the --experimental option.
$ ballerina run --experimental local_transactions_with_participants.bal
2018-12-04 20:14:08,399 INFO  [ballerina/transactions] - Created transaction: c5fe74ef-da8c-41ab-8ba6-e7c6daceea93
2018-12-04 20:14:08,416 INFO  [ballerina/transactions] - Registered local participant: ef90ded8-0a11-4509-b922-c2f3ba501f68:$anon$.$2 for transaction:c5fe74ef-da8c-41ab-8ba6-e7c6daceea93
Invoke local participant function.
Local participant panicked.
2018-12-04 20:14:08,421 INFO  [ballerina/transactions] - Running 2-phase commit for transaction: c5fe74ef-da8c-41ab-8ba6-e7c6daceea93:$anon$.$1
2018-12-04 20:14:08,422 INFO  [ballerina/transactions] - Local prepare failed, aborting..
Retrying transaction
2018-12-04 20:14:08,428 INFO  [ballerina/transactions] - Created transaction: be71f53a-aab1-4b90-9174-b48c96a42a00
2018-12-04 20:14:08,431 INFO  [ballerina/transactions] - Registered local participant: ef90ded8-0a11-4509-b922-c2f3ba501f68:$anon$.$2 for transaction:be71f53a-aab1-4b90-9174-b48c96a42a00
Invoke local participant function.
Local participant panicked.
2018-12-04 20:14:08,432 INFO  [ballerina/transactions] - Running 2-phase commit for transaction: be71f53a-aab1-4b90-9174-b48c96a42a00:$anon$.$1
2018-12-04 20:14:08,433 INFO  [ballerina/transactions] - Local prepare failed, aborting..
Retrying transaction
2018-12-04 20:14:08,435 INFO  [ballerina/transactions] - Created transaction: 2e0c1784-1b17-42e8-a864-ae20d3a25c65
2018-12-04 20:14:08,437 INFO  [ballerina/transactions] - Registered local participant: ef90ded8-0a11-4509-b922-c2f3ba501f68:$anon$.$2 for transaction:2e0c1784-1b17-42e8-a864-ae20d3a25c65
Invoke local participant function.
Local participant panicked.
2018-12-04 20:14:08,437 INFO  [ballerina/transactions] - Running 2-phase commit for transaction: 2e0c1784-1b17-42e8-a864-ae20d3a25c65:$anon$.$1
2018-12-04 20:14:08,438 INFO  [ballerina/transactions] - Local prepare failed, aborting..
Transaction aborted
[ballerina/http] started HTTP/WS listener 10.100.7.118:64310
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    


                    <table class="cBottomBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

     <script>
            $(document).ready(function() {

                hljs.initHighlightingOnLoad();

                $(".switch").click(function() {
                    $(".cCodeRight").toggleClass('cShow');
                    $(".cCodeLeft").toggleClass('cHide');
                });

                // register "copy to clipboard" event to elements with "copy" class
                var clipboard = new ClipboardJS('.copy', {
                    text: function(trigger) {
                        return $('.FullCode').find('pre').text();
                    }
                });

                // Register events show hide tooltip on click event
                clipboard.on('success', function(e) {
                    setTooltip(e.trigger, 'Copied!');
                    hideTooltip(e.trigger);
                });

                clipboard.on('error', function(e) {
                    setTooltip(e.trigger, 'Failed!');
                    hideTooltip(e.trigger);
                });

                $('.copy').tooltip({
                    trigger: 'click',
                    placement: 'bottom'
                });
                $("a.copy").unbind("click");
            });

            function setTooltip(btn, message) {
                $(btn).attr('data-original-title', message)
                    .tooltip('show');
            }

            function hideTooltip(btn) {
                setTimeout(function() {
                    $(btn).tooltip('hide').removeAttr('data-original-title');
                }, 1000);
            }
        </script>
